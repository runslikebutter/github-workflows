name: e2e_tests_2
on:
  workflow_call:
    secrets:
      DOTENV:
        required: true

defaults:
  run:
    shell: bash
    working-directory: ./panel-app

jobs:
  home-page:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: runslikebutter/github-workflows/actions/e2e/prep-e2e@v1
        with:
          DOTENV: ${{ secrets.DOTENV }}

      - name: ">>> Run tests ${{ github.job }}"
        id: try
        run: yarn test:e2e:headless ${{ github.job }} || echo "::set-output name=res::fail"

      - name: ">>> Retry"
        if: steps.try.outputs.res == 'fail'
        run: yarn test:e2e:headless ${{ github.job }}

      - uses: runslikebutter/github-workflows/actions/e2e/extract-logs@v1
        if: failure()

  inactive:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: runslikebutter/github-workflows/actions/e2e/prep-e2e@v1
        with:
          DOTENV: ${{ secrets.DOTENV }}

      - name: ">>> Run tests ${{ github.job }}"
        id: try
        run: yarn test:e2e:headless ${{ github.job }} || echo "::set-output name=res::fail"

      - name: ">>> Retry"
        if: steps.try.outputs.res == 'fail'
        run: yarn test:e2e:headless ${{ github.job }}

      - uses: runslikebutter/github-workflows/actions/e2e/extract-logs@v1
        if: failure()

  qr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: runslikebutter/github-workflows/actions/e2e/prep-e2e@v1
        with:
          DOTENV: ${{ secrets.DOTENV }}

      # Specific to QR tests
      - name: Install ffmpeg .deb package for QR video stream generation
        run: sudo apt update -y && sudo apt install ffmpeg -y

      - name: ">>> Run tests ${{ github.job }}"
        id: try
        run: yarn test:e2e:headless ${{ github.job }} || echo "::set-output name=res::fail"

      - name: ">>> Retry"
        if: steps.try.outputs.res == 'fail'
        run: yarn test:e2e:headless ${{ github.job }}

      - uses: runslikebutter/github-workflows/actions/e2e/extract-logs@v1
        if: failure()
